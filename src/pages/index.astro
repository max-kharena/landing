---
import Layout from '../layouts/Layout.astro';
import TextType from '../components/TextType.astro';
import GradientText from '../components/GradientText.astro';
import LiquidGlassBadge from '../components/LiquidGlassBadge.astro';
import ThemeGrainient from '../components/ThemeGrainient';
import DecryptedText from '../components/DecryptedText';
import GlassSurface from '../components/GlassSurface';
import GradualBlur from '../components/GradualBlur';
import '../styles/global.css';
---

<Layout title="Bluefyn | AI-Native Fintech Infrastructure" description="The AI-native operating system for fintech infrastructure. Join the waitlist for early access to the future of financial technology.">
    <!-- Skip link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="min-h-screen relative overflow-x-hidden flex flex-col">
        <!-- Grainient Background -->
        <div class="grainient-bg" aria-hidden="true">
            <ThemeGrainient
                client:idle
                timeSpeed={0.6}
                colorBalance={0}
                warpStrength={1}
                warpFrequency={5}
                warpSpeed={5}
                warpAmplitude={50}
                blendAngle={0}
                blendSoftness={0.05}
                rotationAmount={500}
                noiseScale={2}
                grainScale={2}
                grainAnimated={false}
                gamma={1}
                saturation={1}
                centerX={0}
                centerY={0}
                zoom={0.9}
            />
        </div>


        <!-- Header blur effect -->
        <GradualBlur
            client:idle
            position="top"
            target="page"
            height="5rem"
            strength={1.5}
            divCount={3}
            curve="ease-out"
            opacity={0.9}
            zIndex={40}
            responsive={true}
        />

        <!-- Header -->
        <header class="fixed top-0 left-0 right-0 z-[200] px-6 md:px-12 py-6">
            <nav class="max-w-7xl mx-auto flex items-center justify-between">
                <GlassSurface
                    client:load
                    width="auto"
                    height="auto"
                    borderRadius={50}
                    brightness={50}
                    opacity={0.93}
                    blur={11}
                    className="logo-badge"
                >
                    <a href="/" class="logo" aria-label="Bluefyn Home">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 93 23" class="logo-svg">
                            <path d="M 83.615 4.666 L 83.615 17.753 L 80.927 17.753 L 80.927 4.666 Z M 83.615 9.485 C 83.615 5.782 85.517 4.564 87.064 4.387 C 90.082 4.032 92.264 6.72 92.264 9.611 L 92.264 17.753 L 89.575 17.753 L 89.575 9.485 C 89.575 7.937 88.738 6.517 86.582 6.517 C 84.782 6.517 83.615 7.937 83.615 9.485 Z" fill="currentColor"></path>
                            <path d="M 72.493 20.163 C 71.834 21.862 71.098 22.42 69.627 22.42 L 68.131 22.42 L 68.131 20.264 L 69.196 20.264 C 70.058 20.264 70.286 19.96 70.489 19.376 C 70.515 19.326 70.844 18.336 70.844 18.336 L 65.366 4.666 L 68.207 4.666 L 71.935 15.268 L 75.663 4.666 L 78.504 4.666 Z" fill="currentColor"></path>
                            <path d="M 59.744 2.156 L 59.744 4.667 L 64.335 4.667 L 64.335 6.823 L 63.853 6.823 C 63.853 6.823 59.744 6.823 59.744 9.74 L 59.744 17.754 L 57.056 17.754 L 57.056 9.968 C 57.056 7.229 61.494 6.848 63.193 6.823 L 53.226 6.823 L 53.226 4.667 L 57.056 4.667 L 57.056 1.776 C 57.056 0.787 57.842 0 58.831 0 L 64.335 0 L 64.335 2.156 Z" fill="currentColor"></path>
                            <path d="M 51.953 11.21 C 51.953 11.337 51.953 11.489 51.928 11.616 L 41.935 11.616 C 42.087 14.025 43.66 15.927 45.587 15.927 C 47.008 15.927 48.225 14.887 48.834 13.391 L 51.624 13.391 C 50.761 16.105 48.402 18.058 45.587 18.058 C 42.062 18.058 39.221 14.989 39.221 11.21 C 39.221 7.431 42.062 4.362 45.587 4.362 C 49.113 4.362 51.953 7.431 51.953 11.21 Z M 42.163 9.485 L 49.011 9.485 C 48.479 7.735 47.134 6.492 45.587 6.492 C 44.04 6.492 42.696 7.735 42.163 9.485 Z" fill="currentColor"></path>
                            <path d="M 35.241 4.666 L 35.241 17.753 L 32.552 17.753 L 32.552 12.934 C 32.552 16.612 30.65 17.855 29.103 18.032 C 26.085 18.362 23.904 15.673 23.904 12.807 L 23.904 4.666 L 26.592 4.666 L 26.592 12.909 C 26.592 14.456 27.404 15.902 29.56 15.902 C 31.386 15.902 32.552 14.456 32.552 12.934 L 32.552 4.666 Z" fill="currentColor"></path>
                            <path d="M 21.791 15.598 L 21.791 17.754 L 12.635 17.754 L 12.635 15.598 L 20.345 15.598 C 18.772 15.547 15.881 15.243 15.881 13.544 L 15.881 2.156 L 12.787 2.156 L 12.787 0 L 16.414 0 C 17.809 0 18.569 0.761 18.569 2.156 L 18.569 13.747 C 18.569 15.598 21.309 15.598 21.309 15.598 Z" fill="currentColor"></path>
                            <path d="M 6.341 4.692 C 9.511 4.337 12.098 7.507 12.098 11.362 C 12.098 15.243 9.41 18.261 6.138 18.058 C 4.692 17.957 3.221 16.942 2.688 15.649 L 2.688 17.754 L 0 17.754 L 0 0 L 2.688 0 L 2.688 11.362 C 2.688 6.163 4.819 4.87 6.341 4.692 Z M 2.688 11.362 C 2.688 14.355 4.312 15.852 6.138 15.852 C 7.862 15.852 9.41 14.178 9.41 11.362 C 9.41 8.547 7.862 6.823 6.138 6.823 C 4.312 6.823 2.688 8.37 2.688 11.362 Z" fill="currentColor"></path>
                        </svg>
                    </a>
                </GlassSurface>
                <div class="flex items-center gap-3">
                    <GlassSurface
                        client:load
                        width="auto"
                        height="auto"
                        borderRadius={50}
                        brightness={50}
                        opacity={0.93}
                        blur={11}
                        className="coming-soon-badge"
                    >
                        <span class="status-dot"></span>
                        <DecryptedText
                            client:load
                            text="Coming Soon"
                            animateOn="hover"
                            speed={40}
                            maxIterations={12}
                        />
                    </GlassSurface>
                    <GlassSurface
                        client:load
                        width="auto"
                        height="auto"
                        borderRadius={50}
                        brightness={50}
                        opacity={0.93}
                        blur={11}
                        className="theme-toggle-glass"
                    >
                        <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle theme">
                            <svg class="moon-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
                            </svg>
                            <svg class="sun-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5" />
                                <path stroke-linecap="round" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                            </svg>
                        </button>
                    </GlassSurface>
                </div>
            </nav>
        </header>

        <!-- Main Content - Centered Apple Style -->
        <main id="main-content" class="relative z-10 flex-1 flex flex-col items-center justify-center px-6 md:px-12 py-32">
            <article class="max-w-4xl mx-auto text-center">
                <!-- Headline -->
                <h1 class="mt-4">
                    <TextType />
                </h1>

                <!-- Subheadline -->
                <p class="subheadline mx-auto mt-2">
                    The unified control plane for vendor economics, operations, and governance.
                </p>

                <!-- CTA Button -->
                <div class="flex items-center justify-center mt-6 md:mt-8">
                    <GlassSurface
                        client:load
                        width="auto"
                        height="auto"
                        borderRadius={50}
                        brightness={45}
                        opacity={0.95}
                        blur={14}
                        className="cta-btn-glass"
                    >
                        <button id="cta-btn" class="cta-btn-inner" aria-expanded="false" aria-controls="waitlist-form">
                            <span>Request access</span>
                            <svg class="w-5 h-5 cta-arrow-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                            </svg>
                        </button>
                    </GlassSurface>
                </div>

                <!-- Form -->
                <div id="waitlist-form" class="form-container max-w-md mx-auto" role="region" aria-label="Waitlist signup form">
                    <GlassSurface
                        client:load
                        width="100%"
                        height="auto"
                        borderRadius={22}
                        brightness={50}
                        opacity={0.93}
                        blur={11}
                        className="form-glass"
                    >
                        <form id="signup-form" class="form-inner space-y-4 w-full" novalidate>
                            <div class="form-field">
                                <label for="name" class="sr-only">Full Name</label>
                                <input type="text" id="name" name="name" placeholder="Eg. Jane Smith" required minlength="2" autocomplete="name" class="form-input">
                                <p class="error-message text-xs mt-2 text-red-400 hidden" data-empty="Please enter your name" data-invalid="Name must be at least 2 characters">Please enter your name</p>
                            </div>
                            <div class="form-field">
                                <label for="email" class="sr-only">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="jane@company.com" required autocomplete="email" class="form-input">
                                <p class="error-message text-xs mt-2 text-red-400 hidden" data-empty="Please enter your email" data-invalid="Please enter a valid email address" data-personal="Please use your work email">Please enter your email</p>
                            </div>
                            <div class="form-field">
                                <label for="message" class="sr-only">Message</label>
                                <textarea id="message" name="message" placeholder="Enter your message..." rows="4" class="form-input form-textarea"></textarea>
                            </div>
                            <GlassSurface
                                client:load
                                width="100%"
                                height="auto"
                                borderRadius={12}
                                brightness={45}
                                opacity={0.95}
                                blur={14}
                                className="submit-btn-glass"
                            >
                                <button type="submit" id="submit-btn" class="submit-btn-inner">
                                    <span class="btn-text">Submit</span>
                                </button>
                            </GlassSurface>
                        </form>

                        <!-- Success State -->
                        <div class="success-state flex-col items-center justify-center gap-3 py-8 w-full" id="success-message">
                            <div class="liquid-glass-checkmark">
                                <div class="checkmark-glow"></div>
                                <div class="checkmark-glass"></div>
                                <div class="checkmark-shine"></div>
                                <div class="checkmark-border"></div>
                                <div class="checkmark-icon">
                                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </div>
                            <p class="text-lg font-medium mt-2">You're on the list!</p>
                            <p class="text-sm text-[var(--text-muted)]">We'll be in touch soon.</p>
                        </div>
                    </GlassSurface>
                </div>

            </article>
        </main>

        <!-- Footer -->
        <footer class="fixed bottom-0 left-0 right-0 z-50 px-6 md:px-12 py-4 pointer-events-none">
            <div class="max-w-7xl mx-auto flex items-center justify-center">
                <p class="footer-text">
                    Â© 2026 Bluefyn. All rights reserved.
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Theme toggle
        document.addEventListener('DOMContentLoaded', function () {
            const themeToggle = document.getElementById('theme-toggle');

            themeToggle?.addEventListener('click', function () {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
        });
    </script>

    <script>
        // Form handling
        document.addEventListener('DOMContentLoaded', function () {
            const ctaBtn = document.getElementById('cta-btn');
            const formContainer = document.getElementById('waitlist-form');
            const form = document.getElementById('signup-form');
            const successMessage = document.getElementById('success-message');
            ctaBtn?.addEventListener('click', function () {
                const isOpen = formContainer?.classList.contains('open');
                const ctaBtnWrapper = ctaBtn.closest('.cta-btn-glass');

                if (!isOpen && formContainer) {
                    formContainer.classList.add('open');
                    ctaBtn.setAttribute('aria-expanded', 'true');
                    if (ctaBtnWrapper) {
                        (ctaBtnWrapper as HTMLElement).style.display = 'none';
                    }

                    // Animate scroll alongside form expansion
                    const duration = 250;
                    const startTime = performance.now();
                    const startScroll = window.scrollY;

                    const animateScroll = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        // Ease out cubic for smooth deceleration
                        const ease = 1 - Math.pow(1 - progress, 3);

                        // Get current scroll height as form expands
                        const targetScroll = document.documentElement.scrollHeight - window.innerHeight;
                        const scrollDelta = targetScroll - startScroll;

                        window.scrollTo(0, startScroll + scrollDelta * ease);

                        if (progress < 1) {
                            requestAnimationFrame(animateScroll);
                        }
                    };

                    requestAnimationFrame(animateScroll);

                    setTimeout(() => {
                        document.getElementById('name')?.focus();
                    }, 300);
                }
            });

            form?.addEventListener('submit', function (e) {
                e.preventDefault();

                const nameInput = document.getElementById('name') as HTMLInputElement;
                const emailInput = document.getElementById('email') as HTMLInputElement;
                const messageInput = document.getElementById('message') as HTMLTextAreaElement;

                const nameError = nameInput?.parentElement?.querySelector('.error-message');
                const emailError = emailInput?.parentElement?.querySelector('.error-message');

                [nameError, emailError].forEach(el => el?.classList.add('hidden'));
                [nameInput, emailInput].forEach(el => { if (el) el.style.borderColor = ''; });

                let isValid = true;

                // Name validation
                const nameValue = nameInput?.value.trim() || '';
                if (!nameValue) {
                    if (nameError) nameError.textContent = nameError.dataset.empty || '';
                    nameError?.classList.remove('hidden');
                    if (nameInput) nameInput.style.borderColor = '#f87171';
                    isValid = false;
                } else if (nameValue.length < 2) {
                    if (nameError) nameError.textContent = nameError.dataset.invalid || '';
                    nameError?.classList.remove('hidden');
                    if (nameInput) nameInput.style.borderColor = '#f87171';
                    isValid = false;
                }

                // Email validation
                const emailValue = emailInput?.value.trim() || '';
                const emailPattern = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
                const personalDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'aol.com', 'icloud.com', 'mail.com', 'protonmail.com', 'zoho.com', 'yandex.com', 'gmx.com', 'live.com', 'msn.com'];

                if (!emailValue) {
                    if (emailError) emailError.textContent = emailError.dataset.empty || '';
                    emailError?.classList.remove('hidden');
                    if (emailInput) emailInput.style.borderColor = '#f87171';
                    isValid = false;
                } else if (!emailPattern.test(emailValue)) {
                    if (emailError) emailError.textContent = emailError.dataset.invalid || '';
                    emailError?.classList.remove('hidden');
                    if (emailInput) emailInput.style.borderColor = '#f87171';
                    isValid = false;
                } else {
                    const domain = emailValue.split('@')[1]?.toLowerCase();
                    if (domain && personalDomains.includes(domain)) {
                        if (emailError) emailError.textContent = emailError.dataset.personal || '';
                        emailError?.classList.remove('hidden');
                        if (emailInput) emailInput.style.borderColor = '#f87171';
                        isValid = false;
                    }
                }

                if (!isValid) return;

                const formData = {
                    name: nameInput?.value.trim(),
                    email: emailInput?.value.trim(),
                    message: messageInput?.value.trim()
                };

                // Disable all inputs during submission
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => input.setAttribute('disabled', 'true'));

                const submitBtn = document.getElementById('submit-btn');
                if (submitBtn) submitBtn.setAttribute('disabled', 'true');

                // Show success state immediately
                form.classList.add('hide');
                successMessage?.classList.add('show');
            });

            document.querySelectorAll('#signup-form input').forEach(input => {
                input.addEventListener('input', function (this: HTMLInputElement) {
                    this.style.borderColor = '';
                    const error = this.parentElement?.querySelector('.error-message');
                    if (error) error.classList.add('hidden');
                });
            });
        });
    </script>
</Layout>
